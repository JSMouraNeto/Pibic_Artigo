2025-09-10 12:56:33,046 - INFO - Usando dispositivo: cuda
2025-09-10 12:56:33,171 - INFO - Dataset dividido: 20958 treino, 6986 validação, 6987 teste.
2025-09-10 12:56:33,495 - INFO - --- Iniciando Treinamento com ResNet-50 ---
2025-09-10 12:57:09,633 - INFO - Epoch 1/25: Train Loss: 0.6394, Val F1-Macro: 0.7639
2025-09-10 12:57:09,697 - INFO - Modelo salvo! Novo melhor Val F1-Score: 0.7639
2025-09-10 12:57:45,536 - INFO - Epoch 2/25: Train Loss: 0.4946, Val F1-Macro: 0.8036
2025-09-10 12:57:45,647 - INFO - Modelo salvo! Novo melhor Val F1-Score: 0.8036
2025-09-10 12:58:21,464 - INFO - Epoch 3/25: Train Loss: 0.4606, Val F1-Macro: 0.8050
2025-09-10 12:58:21,578 - INFO - Modelo salvo! Novo melhor Val F1-Score: 0.8050
2025-09-10 12:58:57,517 - INFO - Epoch 4/25: Train Loss: 0.4464, Val F1-Macro: 0.8153
2025-09-10 12:58:57,646 - INFO - Modelo salvo! Novo melhor Val F1-Score: 0.8153
2025-09-10 12:59:33,525 - INFO - Epoch 5/25: Train Loss: 0.4271, Val F1-Macro: 0.8208
2025-09-10 12:59:33,662 - INFO - Modelo salvo! Novo melhor Val F1-Score: 0.8208
2025-09-10 13:00:09,500 - INFO - Epoch 6/25: Train Loss: 0.4145, Val F1-Macro: 0.8303
2025-09-10 13:00:09,612 - INFO - Modelo salvo! Novo melhor Val F1-Score: 0.8303
2025-09-10 13:00:45,317 - INFO - Epoch 7/25: Train Loss: 0.4107, Val F1-Macro: 0.8144
2025-09-10 13:01:21,067 - INFO - Epoch 8/25: Train Loss: 0.3984, Val F1-Macro: 0.8331
2025-09-10 13:01:21,182 - INFO - Modelo salvo! Novo melhor Val F1-Score: 0.8331
2025-09-10 13:01:56,844 - INFO - Epoch 9/25: Train Loss: 0.3915, Val F1-Macro: 0.8443
2025-09-10 13:01:56,946 - INFO - Modelo salvo! Novo melhor Val F1-Score: 0.8443
2025-09-10 13:02:32,883 - INFO - Epoch 10/25: Train Loss: 0.3886, Val F1-Macro: 0.8366
2025-09-10 13:03:08,970 - INFO - Epoch 11/25: Train Loss: 0.3933, Val F1-Macro: 0.8464
2025-09-10 13:03:09,095 - INFO - Modelo salvo! Novo melhor Val F1-Score: 0.8464
2025-09-10 13:03:45,086 - INFO - Epoch 12/25: Train Loss: 0.3794, Val F1-Macro: 0.8380
2025-09-10 13:04:21,071 - INFO - Epoch 13/25: Train Loss: 0.3740, Val F1-Macro: 0.8395
2025-09-10 13:04:57,068 - INFO - Epoch 14/25: Train Loss: 0.3781, Val F1-Macro: 0.8396
2025-09-10 13:05:32,931 - INFO - Epoch 15/25: Train Loss: 0.3730, Val F1-Macro: 0.8371
2025-09-10 13:06:08,700 - INFO - Epoch 16/25: Train Loss: 0.3679, Val F1-Macro: 0.8429
2025-09-10 13:06:44,479 - INFO - Epoch 17/25: Train Loss: 0.3625, Val F1-Macro: 0.8440
2025-09-10 13:07:20,245 - INFO - Epoch 18/25: Train Loss: 0.3659, Val F1-Macro: 0.8340
2025-09-10 13:07:56,021 - INFO - Epoch 19/25: Train Loss: 0.3706, Val F1-Macro: 0.8339
2025-09-10 13:08:31,815 - INFO - Epoch 20/25: Train Loss: 0.3577, Val F1-Macro: 0.8407
2025-09-10 13:09:07,650 - INFO - Epoch 21/25: Train Loss: 0.3644, Val F1-Macro: 0.8436
2025-09-10 13:09:43,377 - INFO - Epoch 22/25: Train Loss: 0.3544, Val F1-Macro: 0.8275
2025-09-10 13:10:19,163 - INFO - Epoch 23/25: Train Loss: 0.3639, Val F1-Macro: 0.8500
2025-09-10 13:10:19,275 - INFO - Modelo salvo! Novo melhor Val F1-Score: 0.8500
2025-09-10 13:10:55,010 - INFO - Epoch 24/25: Train Loss: 0.3592, Val F1-Macro: 0.8480
2025-09-10 13:11:30,794 - INFO - Epoch 25/25: Train Loss: 0.3585, Val F1-Macro: 0.8489
2025-09-10 13:11:30,794 - INFO - 
--- Avaliação Final no Conjunto de Teste ---
2025-09-10 13:11:45,123 - INFO - 
Relatório de Classificação:
                     precision    recall  f1-score   support

              COVID       0.93      0.91      0.92      1449
       Lung_Opacity       0.84      0.89      0.87      1203
             Normal       0.90      0.89      0.89      2038
pneumonia_bacterial       0.81      0.74      0.77      1104
    Viral Pneumonia       0.76      0.83      0.80      1193

           accuracy                           0.86      6987
          macro avg       0.85      0.85      0.85      6987
       weighted avg       0.86      0.86      0.86      6987

2025-09-10 13:11:45,211 - INFO - Matriz de confusão salva em: training_results_vfinal/dataset_deduplicado_20250910_125633/dataset_deduplicado_confusion_matrix.png
2025-09-10 13:11:45,211 - INFO - 
--- Gerando visualizações Grad-CAM ---
2025-09-10 13:11:45,211 - INFO - Gerando Grad-CAM para 1 exemplo(s) de cada classe...
2025-09-10 13:11:45,567 - CRITICAL - Ocorreu um erro fatal: mean() received an invalid combination of arguments - got (NoneType, dim=list), but expected one of:
 * (Tensor input, *, torch.dtype dtype = None, Tensor out = None)
 * (Tensor input, tuple of ints dim, bool keepdim = False, *, torch.dtype dtype = None, Tensor out = None)
 * (Tensor input, tuple of names dim, bool keepdim = False, *, torch.dtype dtype = None, Tensor out = None)
Traceback (most recent call last):
  File "/home/mob4ai-001/Pibic_Artigo/algoritimosTreinamento/train_resnet.py", line 360, in <module>
    train_and_evaluate(run_args, logger)
  File "/home/mob4ai-001/Pibic_Artigo/algoritimosTreinamento/train_resnet.py", line 304, in train_and_evaluate
    visualize_and_save_grad_cam(
  File "/home/mob4ai-001/Pibic_Artigo/algoritimosTreinamento/train_resnet.py", line 193, in visualize_and_save_grad_cam
    heatmap = grad_cam(img_tensor, class_idx=true_label_idx)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mob4ai-001/Pibic_Artigo/algoritimosTreinamento/train_resnet.py", line 160, in __call__
    pooled_gradients = torch.mean(self.gradients, dim=[0, 2, 3])
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: mean() received an invalid combination of arguments - got (NoneType, dim=list), but expected one of:
 * (Tensor input, *, torch.dtype dtype = None, Tensor out = None)
 * (Tensor input, tuple of ints dim, bool keepdim = False, *, torch.dtype dtype = None, Tensor out = None)
 * (Tensor input, tuple of names dim, bool keepdim = False, *, torch.dtype dtype = None, Tensor out = None)

